<div class="container mt-4">
  <h1 class="heading">Welcome To The Greenhouse</h1>

  <div class="row">
    <!-- List -->
    <div class="col-md-6">
      <h3 class="mb-3">My Plants</h3>
      <ul class="list-group">
        <li
          class="list-group-item d-flex justify-content-between align-items-center"
          *ngFor="let plant of plants"
          (click)="selectPlant(plant)"
          [ngClass]="rowSeverityClass(plant)"
        >
          <div class="item-left">
            <span class="name">{{ plant.name }}</span>
            <span class="badge season"
                  [ngClass]="'season-' + (seasonOf(plant) | lowercase)">
              {{ seasonOf(plant) }}
            </span>
          </div>

          <div class="item-right">
            <span class="chip"
                  [ngClass]="'chip-' + waterChip(plant).severity">
              {{ waterChip(plant).label }}
            </span>

            <div class="btn-group ms-2">
              <button
                class="btn btn-sm btn-warning"
                (click)="editPlant(plant._id!); $event.stopPropagation();">
                Edit
              </button>
              <button
                class="btn btn-sm btn-danger"
                (click)="deletePlant(plant._id!); $event.stopPropagation();">
                Delete
              </button>
            </div>
          </div>
        </li>
      </ul>
    </div>

    <!-- Details -->
    <div class="col-md-6">
      <h3 class="mb-3">Plant Details</h3>

      <div *ngIf="selectedPlant as p" class="card">
        <div class="card-body">
          <div class="d-flex align-items-center gap-2">
            <h5 class="card-title m-0">{{ p.name }}</h5>
            <span class="badge season" [ngClass]="'season-' + (seasonOf(p) | lowercase)">
              {{ seasonOf(p) }}
            </span>
            <span class="chip" [ngClass]="'chip-' + waterChip(p).severity">
              {{ waterChip(p).label }}
            </span>
          </div>

          <p class="mt-2"><strong>Species:</strong> {{ p.species }}</p>
          <p><strong>Planting Date:</strong> {{ p.plantingDate }}</p>

          <p><strong>Watering Frequency:</strong>
            {{ p.wateringFrequency }}
            <span *ngIf="p.wateringFrequency === 1">— Nearly Never</span>
            <span *ngIf="p.wateringFrequency === 2">— Weekly</span>
            <span *ngIf="p.wateringFrequency === 3">— Daily</span>
          </p>

          <p><strong>Light Requirement:</strong> {{ p.lightRequirement || 'N/A' }}</p>

          <div *ngIf="p.imageUrl">
            <img [src]="p.imageUrl" class="img-fluid mt-2" style="max-height: 200px;" />
          </div>
        </div>
      </div>

      <div *ngIf="!selectedPlant" class="alert alert-info">
        Select a plant to view details.
      </div>
    </div>
  </div>

  <!-- Create -->
  <div class="row mt-4">
    <div class="col-md-12">
      <h3 class="mb-3">Add a New Plant</h3>

      <form (ngSubmit)="onSubmit()" class="form-inline" enctype="multipart/form-data">
        <input type="text" class="form-control mb-2 mr-sm-2" placeholder="Plant Name"
               [(ngModel)]="newPlant.name" name="name" required />

        <input type="text" class="form-control mb-2 mr-sm-2" placeholder="Species"
               [(ngModel)]="newPlant.species" name="species" required />

        <input type="date" class="form-control mb-2 mr-sm-2"
               [(ngModel)]="newPlant.plantingDate" name="plantingDate" required />

        <select class="form-control mb-2 mr-sm-2"
                [(ngModel)]="newPlant.wateringFrequency" name="wateringFrequency" required>
          <option [value]="1">1 (Low - Nearly Never)</option>
          <option [value]="2">2 (Moderate - Weekly)</option>
          <option [value]="3">3 (High - Daily)</option>
        </select>

        <select class="form-control mb-2 mr-sm-2"
                [(ngModel)]="newPlant.lightRequirement" name="lightRequirement" required>
          <option value="Full Sun">Full Sun</option>
          <option value="Partial Shade">Partial Shade</option>
          <option value="Low Light">Low Light</option>
        </select>

        <!-- Image options -->
        <div class="image-selection-container mb-2">
          <div class="image-options">
            <div class="option">
              <label>Upload your own image:</label>
              <input type="file" class="form-control" (change)="onFileChange($event)" accept="image/*" />
            </div>

            <div class="option-divider">OR</div>

            <div class="option">
              <button type="button" (click)="toggleImageGallery()" class="btn btn-outline-success">
                Choose from Gallery
              </button>
            </div>
          </div>

          <div *ngIf="showImageGallery">
            <app-plant-image-gallery
              (imageSelected)="onGalleryImageSelected($event)"
              (close)="closeImageGallery()">
            </app-plant-image-gallery>
          </div>

          <div *ngIf="imagePreviewUrl" class="mt-2 image-preview">
            <p class="mb-1">Preview:</p>
            <img [src]="imagePreviewUrl" class="img-thumbnail" style="max-height: 120px;" />
          </div>
        </div>

        <button type="submit" class="btn btn-primary mb-2">Add Plant</button>
      </form>
    </div>
  </div>
</div>
